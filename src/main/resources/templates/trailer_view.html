<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Meta tags -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap CSS (Temporally location)-->
    <link type="text/css" rel="stylesheet" href="/styles/css/styles.css">

    <!-- Customize css -->
    <link type="text/css" rel="stylesheet" href="/styles/css/customize__navbar.css">
    <link type="text/css" rel="stylesheet" href="/styles/css/customize__trailer-preview.css">

    <!-- Header styles -->
    <link rel="icon" href="/resources/icons/main_icon.ico">
    <title th:text="${title}">...</title>
</head>
<body>

    <!-- Nav header -->
    <header th:replace="/fragments/navbar :: navbar_header"></header>

    <main class="container my-4 my-lg-5 overflow-hidden">
        <div class="row text-light">
            
            <!-- Trailer View -->
            <div class="col-lg-9 ">

                <!-- Lazy loading -->
                <div style="width: 100%; max-width: 800px; box-shadow: 6px 6px 10px rgb(20, 2, 49); margin: 0 auto">
                    <div style="position: relative; left: 0; top: 0; padding-bottom: 56.15%; height: 0; overflow: hidden;">
                        <iframe 
                            id="trailerBox"
                            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;"
                            loading="lazy";
                            th:src="@{ https://www.youtube.com/embed/{id}(id=${trailer.getId})  }" 
                            title="Video Trailer Iframe" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; 
                            gyroscope; picture-in-picture" 
                            allowfullscreen>
                        </iframe>
                    </div>
                </div>
                
                <!-- Info Trailer & Actions -->
                <div class="row g-0">

                    <!-- Trailer title-->
                    <div class="col-12 my-3">
                        <!-- Audio icon -->
                        <span th:if="${ trailer.getLanguage.getIdLanguage != '0' }">
                            <img src="/resources/icons/volume__icon.svg" 
                                alt="Icono de audio"> 
                            <img th:src="${ trailer.getLanguage.getIconLanguage }" 
                                th:alt="${ 'Icono de audio ' + trailer.getLanguage.getNameLanguage.toLowerCase() }" 
                                style="width: 20px">
                        </span>
                        <!-- Subtitle icon -->
                        <span th:if="${ trailer.getSubtitle.getIdLanguage != '0' }">
                            <img src="/resources/icons/subtitle__icon.svg" 
                                alt="Icono de sutitulo"> 
                            <img th:src="${ trailer.getSubtitle.getIconLanguage }"
                                th:alt="${ 'Icono de subtitulos en ' + trailer.getSubtitle.getNameLanguage.toLowerCase() }" 
                                style="width: 20px">
                        </span>
                        <!-- Title -->
                        <span th:text="${trailer.getTitle}" class="h6 ms-1"></span>
                    </div>

                    <!-- Action Buttons -->
                    <div class="col-12 ">
                        <div class="row h-100 g-2">

                            <!-- Repor video -->
                            <div class="col-12 col-sm-6">
                                <button type="button" class="btn btn-danger h-100 w-100" data-bs-toggle="modal" data-bs-target="#reportModal">
                                    <img src="/resources/icons/info.svg"> 
                                    Reportar problema
                                </button>

                                <!-- List Modal -->
                                <div class="modal fade" 
                                    id="reportModal" 
                                    tabindex="-1" 
                                    aria-labelledby="reportModalLabel" 
                                    aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                                        <div class="modal-content w-auto mx-auto">
                                            <div class="modal-body overflow-hidden">
                                                <!-- List header -->
                                                <div class="d-flex justify-content-between mb-1">
                                                    <div class="h5">Â¿Cual es el problema?</div>
                                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>

                                                <form action="">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio" name="reproduction" value="reproduction" id="reproductionId">
                                                        <label class="form-check-label" for="flexRadioDefault1">
                                                            El video no se reproduce
                                                        </label>
                                                    </div>

                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio" name="videoSize" value="videoSize" id="videoSizeId">
                                                        <label class="form-check-label" for="flexRadioDefault1">
                                                            El video luce descolocado o se pasa de la pantalla
                                                        </label>
                                                    </div>

                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio" name="audio" value="audio" id="audioId">
                                                        <label class="form-check-label" for="flexRadioDefault1">
                                                            El video no se escucha
                                                        </label>
                                                    </div>

                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio" name="other" value="other" id="otherId">
                                                        <label class="form-check-label" for="flexRadioDefault1">
                                                            Otro
                                                        </label>
                                                    </div>

                                                    <button type="submit" class="btn btn-danger mx-auto mt-2 w-100" data-bs-dismiss="modal"
                                                        onclick="event.preventDefault()">
                                                        <img src="/resources/icons/info.svg"> 
                                                        Reportar video
                                                    </button>
                                                </form>
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Save Playlist -->
                            <div class="col-12 col-sm-6">
                                <button type="button" class="btn btn-dark h-100 w-100" data-bs-toggle="modal" data-bs-target="#listModal">
                                    <img src="/resources/icons/add.svg"> 
                                    Guardar
                                </button>
                                
                                <!-- List Modal -->
                                <div class="modal fade" 
                                    id="listModal" 
                                    tabindex="-1" 
                                    aria-labelledby="exampleModalLabel" 
                                    aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                                        <div class="modal-content w-auto mx-auto">
                                            <div class="modal-body overflow-hidden">
                                                <!-- List header -->
                                                <div class="d-flex justify-content-between">
                                                    <div class="h5">Guardar en:</div>
                                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>

                                                <!-- List each -->
                                                <div class="container">
                                                    <div class="form-check">
                                                        <input value="favourites" id="favourites"
                                                            class="form-check-input" type="checkbox">
                                                        <label for="favourites"
                                                            class="form-check-label text-truncate">Favoritos
                                                        </label>
                                                    </div>

                                                    <div class="form-check" th:each="list : ${userList}">
                                                        <input th:value="${list.getName.toLowerCase()}"
                                                            th:id="check- + ${list.getId}"
                                                            class="form-check-input" type="checkbox">
                                                        <label th:text="${list.getName}"
                                                            th:for="check- + ${list.getId}"
                                                            class="form-check-label text-truncate">
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- List Footer -->
                                            <div class="modal-footer ">
                                                <button type="button" class="btn btn-secondary mx-auto" 
                                                    data-bs-toggle="modal" data-bs-target="#createListModal">
                                                    <img src="/resources/icons/list-plus.svg"> Crear nueva playlist
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Create List Modal -->
                                <div class="modal fade" 
                                    id="createListModal" 
                                    tabindex="-1" 
                                    aria-labelledby="createListModalLabel" 
                                    aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                                        <div class="modal-content w-auto mx-auto">
                                            <div class="modal-body overflow-hidden">
                                                <!-- List header -->
                                                <div class="d-flex justify-content-end">
                                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>

                                                <!-- Form Body -->
                                                <form th:action="@{/app/list/createNewList/{id}(id=${trailer.getId}) }" th:object="${userList}" method="post">

                                                    <label for="inputNameList">Inserte Nombre: </label>
                                                    <input type="text" class="bg-primary form-control" name="name" id="inputNameList">
                                                    
                                                    <button type="submit" class="btn btn-secondary w-100 mt-3" data-bs-dismiss="modal"
                                                        onclick="">
                                                        <img src="/resources/icons/list-check.svg">
                                                        Crear lista
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

                <!-- Info Movie -->
                <div class="row g-0 my-4 my-md-5 c_movieInfo">

                    <!-- Cover Movie -->
                    <div class="col-6 col-md-4 col-xxl-3 mb-3 mx-auto">
                        <img th:src="@{${ trailer.getMovie.getCoverUrl }}" 
                            th:alt="${ 'Portada de ' + trailer.getMovie.getName }" 
                            class="c_coverMovieImg">
                    </div>

                    <!-- Details Movie -->
                    <div class="col-12 col-md-8 col-xxl-9 px-4">

                        <!-- Title Movie -->
                        <a href="#">
                            <p th:text="${ trailer.getMovie.getName }"
                                class="h5 text-center text-md-start"></p>
                        </a>

                        <!-- Categories Movie -->
                        <div class="row my-3 my-md-2 justify-content-center justify-content-md-start">
                            <div th:each="genre : ${ trailer.getMovie.getGenreList }"
                                class="col-auto bg-secondary text-light rounded-pill m-1">

                                <small th:text="${ genre.getNameGenre }"></small>
                            </div>

                        </div>

                        <!-- Persons Movie -->
                        <div class="my-2">
                            <span>
                                <b>Director(es):</b> 
                                <span th:each="director : ${ trailer.getMovie.getDirectorsList }">
                                    <!-- Director's Full Name -->
                                    <span th:text="${director.getName + ' ' + director.getLastname}"></span>
                                    <!-- DOT OR COMMA -->
                                    <span th:if="${directorStat.index != trailer.getMovie.getDirectorsList.size()-1}">, </span>
                                    <span th:if="${directorStat.index == trailer.getMovie.getDirectorsList.size()-1}">.</span>
                                </span>
                            </span>
                        </div>

                        <!-- Sinopsis -->
                        <div>
                            <b>Sinopsis:</b>
                            <span th:text="${ trailer.getMovie.getSynopsis }"></span>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Related videos -->
            <div class="col-lg-3 mt-3 mt-lg-0">
                <p class="h4 mb-4">Videos Relacionados</p>

                <!-- Trailers Divs-->
                <div th:each="related : ${relatedTrailers}" 
                    class="col px-3 py-1 c_link-video-container">

                    <a th:href="@{/app/trailer/view/{id}(id=${related.getId}) }"
                        th:title="${related.getTitle}" 
                        th:data-bs-content-id="${ 'popover' + related.getId}" 
                        tabindex="0" data-bs-toggle="popover" data-bs-placement="left" 
                        data-bs-trigger="hover focus">

                        <div class="position-relative overflow-hidden rounded-3">
                            <!-- Image -->
                            <img th:src="@{${ 'http://i.ytimg.com/vi/' + related.getId + '/mqdefault.jpg' }}" 
                                th:alt="${related.getTitle}" class="w-100 c_img-video">
                            <!-- Icons Language -->
                            <div th:if="${ related.getLanguage.getIdLanguage != '0' || related.getSubtitle.getIdLanguage != '0' }"
                                class="position-absolute top-0 end-0 p-2 d-flex rounded-3 c_languageInfo">
                                <!-- Audio Icon -->
                                <div th:if="${ related.getLanguage.getIdLanguage != '0' }"
                                    class="d-flex">
                                    <img src="/resources/icons/volume__icon.svg" 
                                        alt="Icono de audio" class="me-1"> 
                                    <img th:src="${ related.getLanguage.getIconLanguage }" 
                                        th:alt="${ 'Icono de audio ' + related.getLanguage.getNameLanguage.toLowerCase() }" 
                                        style="height: 100%;">
                                </div>
                                <!-- Subtitle Icon -->
                                <div th:if="${ related.getSubtitle.getIdLanguage != '0' }"
                                    class="d-flex ms-2">
                                    <img src="/resources/icons/subtitle__icon.svg" 
                                        alt="Icono de subtitulo" class="me-1"> 
                                    <img th:src="${ related.getSubtitle.getIconLanguage }"
                                        th:alt="${ 'Icono de subtitulos en ' + related.getSubtitle.getNameLanguage.toLowerCase() }" 
                                        style="height: 100%;">
                                </div>
                            </div>
                        </div>
                        <p th:text="${ related.getTitle }"
                            class="text-truncate"></p>
                    </a>

                    <!-- Popover -->
                    <div th:id="${ 'popover' + related.getId}" class="d-none">
                        <div class="row justify-content-center px-1">
                            <div th:each="genre : ${ related.getMovie.getGenreList }"
                                th:text="${ genre.getNameGenre }"
                                class="col-auto bg-secondary text-light rounded-pill m-1"></div>
                        </div>
                    </div>
                </div>

            </div>
            
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-5 pb-5 text-light text-center ">
        Copyright &copy; Trailers web 2022
        <div class="mt-1">
            <a href="#" style="text-decoration: none;">
                <img src="/resources/icons/facebook.svg" alt="Link a facebook">
            </a>
            <a href="#" style="text-decoration: none;">
                <img src="/resources/icons/twitter.svg" alt="Link a twitter">
            </a>
            <a href="#" style="text-decoration: none;">
                <img src="/resources/icons/instagram.svg" alt="Link a instagram">
            </a>
        </div>
    </footer>

    <!-- Insert Trailer Document -->
    <script th:inline="javascript">
        /*[+
        let getIdVideo  = [[${trailer.id}]];
        +]*/
        const trailerDocument = `
            <style>
                * { padding: 0; margin: 0; overflow: hidden; }
                body, html { heigth: 100%; }
                img, svg { position: absolute; width: 100%; top: 0; bottom: 0; margin: auto; }
                svg { filter: drop-shadow(1px 1px 10px hsl(206.5, 70.7%, 8%)); transition: all 250ms ease-in-out; }
                body:hover svg { filter: drop-shadow(1px 1px 10px hsl(206.5, 0%, 10%)); transform: scale(1.2); }
            </style>
            <a href = https://www.youtube.com/embed/` + getIdVideo + `?autoplay=1&color=white>
                <img src='https://img.youtube.com/vi/` + getIdVideo + `/sddefault.jpg' alt='VideoTrailer'>
                <svg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 24 24' fill='none' stroke='#ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-play-circle'><circle cx='12' cy='12' r='10'></circle><polygon points='10 8 16 12 10 16 10 8'></polygon></svg>
            </a>
        `;
        const trailerBox = document.querySelector("#trailerBox");
        trailerBox.srcdoc = trailerDocument;
    </script>

    <!-- Bootstrap JS -->
    <script src="/utils/popper.min.js"></script>
    <script src="/utils/bootstrap.js"></script>
    <!-- Enable tooltips -->
    <script src="/utils/enablePopovers.js"></script>

    <!-- Customm Js -->
    <script src="/utils/autoadjust_16-9__video-proportions.js"></script>
    <script src="/utils/autoadjust_10-14__video-proportions.js"></script>
</body>
</html>